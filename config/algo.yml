# Paper Trading Mode
# Set to true to enable paper trading (simulated trading with ₹1 lakh balance)
# Paper positions are tracked but no real orders are placed
paper_trading:
  enabled: true
  balance: 100000 # ₹1 lakh

indices:
  - {
      key: NIFTY,
      segment: IDX_I,
      sid: "13",
      capital_alloc_pct: 0.30,
      max_same_side: 1,
      cooldown_sec: 180,
    }
  - {
      key: BANKNIFTY,
      segment: IDX_I,
      sid: "25",
      capital_alloc_pct: 0.30,
      max_same_side: 1,
      cooldown_sec: 180,
    }
  - {
      key: SENSEX,
      segment: IDX_I,
      sid: "51",
      capital_alloc_pct: 0.30,
      max_same_side: 1,
      cooldown_sec: 180,
    }

risk:
  sl_pct: 0.03        # -3% STOP LOSS (fallback, dynamic reverse_loss takes precedence)
  tp_pct: 0.05        # +5% TAKE PROFIT
  per_trade_risk_pct: 0.15

  # Bidirectional trailing stops (enhanced with adaptive drawdown schedule)
  trail_step_pct: 0.03          # 3% trailing step (for breakeven calculation)
  breakeven_after_gain: 0.05    # Lock breakeven at +5% profit
  exit_drop_pct: 0.03           # Fixed trailing threshold (fallback, adaptive schedule takes precedence)
  min_profit_rupees: 0          # allow immediate TP exits

  # Upward exponential drawdown (activated when pnl >= activation_profit_pct)
  drawdown:
    activation_profit_pct: 3.0
    profit_min: 3.0
    profit_max: 30.0
    dd_start_pct: 15.0   # start allowed DD at this % when profit == profit_min
    dd_end_pct: 1.0      # floor allowed DD at this % when profit >= profit_max
    exponential_k: 3.0   # curve steepness
    index_floors:
      NIFTY: 1.0
      BANKNIFTY: 1.2
      SENSEX: 1.5

  # Reverse (below entry) dynamic loss tightening
  reverse_loss:
    enabled: true
    max_loss_pct: 20.0   # starting allowed loss when position just turned red
    min_loss_pct: 5.0    # tightest allowed loss when pnl hits -30%
    loss_span_pct: 30.0  # map -0..-loss_span_pct to max_loss_pct..min_loss_pct
    time_tighten_per_min: 2.0 # % tightening per minute spent below entry
    atr_penalty_thresholds:
      - { threshold: 0.75, penalty_pct: 3.0 }
      - { threshold: 0.60, penalty_pct: 5.0 }

  # Early Trend Failure Exit (ETF)
  etf:
    enabled: true
    activation_profit_pct: 7.0  # ETF checks apply until trailing activates
    trend_score_drop_pct: 30.0  # drop from peak trend score to trigger ETF
    adx_collapse_threshold: 10  # ADX under this triggers ETF
    atr_ratio_threshold: 0.55   # collapse detection
    confirmation_ticks: 2       # consecutive tick confirmations

# risk:
#   # daily_loss_limit_pct: 0.06 # Circuit breaker disabled - removed per requirement
#   per_trade_risk_pct: 0.15
#   sl_pct: 0.10 # 25% stop loss for options (high volatility)
#   tp_pct: 0.20 # 60% take profit target
#   trail_step_pct: 0.03 # 5% trailing step for options
#   breakeven_after_gain: 0.05 # trigger breakeven lock at +10% gain
#   exit_drop_pct: 0.03 # trigger trailing exit after 3% pullback from high-water mark
#   min_profit_rupees: 1000 # Minimum profit required per position before allowing profit-based exits (₹1000)

signals:
  primary_timeframe: "1m"
  confirmation_timeframe: "5m"
  enable_confirmation_timeframe: false # Enable/disable 5m confirmation analysis
  enable_adx_filter: false # Enable/disable ADX strength filtering
  use_strategy_recommendations: false # Enable/disable backtest-based strategy recommendations (SimpleMomentumStrategy, InsideBarStrategy, SupertrendAdxStrategy)
  validation_mode: "aggressive" # conservative | balanced | aggressive
  supertrend:
    period: 10
    base_multiplier: 2.0
    training_period: 50
    num_clusters: 3
    performance_alpha: 0.1
    multiplier_candidates: [1.5, 2.0, 2.5, 3.0, 3.5]
  adx:
    min_strength: 18
    confirmation_min_strength: 20
  scaling:
    enabled: true
    max_multiplier: 3
    decay_seconds: 900
  validation_modes:
    conservative:
      adx_min_strength: 25
      adx_confirmation_min_strength: 30
      iv_rank_max: 0.6
      iv_rank_min: 0.15
      theta_risk_cutoff_hour: 14
      theta_risk_cutoff_minute: 0
      require_trend_confirmation: true
      require_iv_rank_check: true
      require_theta_risk_check: true
    balanced:
      adx_min_strength: 18
      adx_confirmation_min_strength: 20
      iv_rank_max: 0.8
      iv_rank_min: 0.1
      theta_risk_cutoff_hour: 14
      theta_risk_cutoff_minute: 30
      require_trend_confirmation: true
      require_iv_rank_check: true
      require_theta_risk_check: true
    aggressive:
      adx_min_strength: 15
      adx_confirmation_min_strength: 18
      iv_rank_max: 0.9
      iv_rank_min: 0.05
      theta_risk_cutoff_hour: 15
      theta_risk_cutoff_minute: 0
      require_trend_confirmation: false
      require_iv_rank_check: true
      require_theta_risk_check: false

option_chain:
  atm_window_pct: 0.1 # Not used - now using fixed strike steps (ATM, ATM±1, ATM±2, ATM±3)
  min_iv: 10 # Minimum implied volatility
  max_iv: 60 # Maximum implied volatility
  min_oi: 50000 # Minimum open interest
  max_spread_pct: 3.0 # Maximum bid-ask spread percentage

data_freshness:
  disable_ohlc_caching: false # Set to true to always fetch fresh OHLC data
  disable_option_chain_caching: false # Set to true to always fetch fresh option chain data
  ohlc_cache_duration_minutes: 5 # Cache OHLC data for 5 minutes
  option_chain_cache_duration_minutes: 2 # Cache option chain data for 2 minutes
